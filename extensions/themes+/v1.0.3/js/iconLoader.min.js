const DEFAULT_ICON = 'assets/icons/Travel-Explore--Streamline-Outlined-Material-Symbols.svg';

export async function safeSetIconWithFallback(imgEl, src, fallback = DEFAULT_ICON, srcType = '') {
    if (!imgEl || !src) return Promise.resolve(false);
    return new Promise((resolve) => {
        let settled = false;
        const cleanup = () => { try { clearTimeout(timeout); imgEl.onload = null; imgEl.onerror = null; } catch (e) {} };
        imgEl.onload = () => { if (settled) return; settled = true; cleanup(); resolve(true); };
        imgEl.onerror = () => { if (settled) return; settled = true; cleanup(); resolve(false); };
        const timeout = setTimeout(() => { if (settled) return; settled = true; cleanup(); resolve(false); }, 3500);
        try { imgEl.src = src; } catch (e) { cleanup(); resolve(false); }
    });
}

export { DEFAULT_ICON };

export function clearIconLoaderCacheAPI() { /* no-op */ }
export function getIconLoaderCacheSummaryAPI() { return { failedHosts: [], placeholderSrcs: [], responseCache: [] }; }

try { if (typeof window !== 'undefined') window.IconLoaderMin = { clearCache: clearIconLoaderCacheAPI, summary: getIconLoaderCacheSummaryAPI }; } catch (e) {}
